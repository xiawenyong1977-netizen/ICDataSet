# å¾®ä¿¡æˆªå›¾ç”ŸæˆæŠ€æœ¯å®ç°æ€»ç»“

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºPythonçš„å¾®ä¿¡èŠå¤©æˆªå›¾ç”Ÿæˆå™¨ï¼Œèƒ½å¤Ÿç”Ÿæˆé«˜åº¦é€¼çœŸçš„å¾®ä¿¡èŠå¤©ç•Œé¢æˆªå›¾ã€‚ä¸»è¦ç”¨äºæœºå™¨å­¦ä¹ è®­ç»ƒæ•°æ®çš„ç”Ÿæˆï¼Œç‰¹åˆ«æ˜¯å¾®ä¿¡æˆªå›¾è¯†åˆ«æ¨¡å‹çš„è®­ç»ƒã€‚

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **Python 3.x** - ä¸»è¦å¼€å‘è¯­è¨€
- **PIL/Pillow** - å›¾åƒå¤„ç†å’Œç»˜åˆ¶
- **NumPy** - æ•°å€¼è®¡ç®—å’Œå›¾åƒæ•°ç»„å¤„ç†
- **Requests** - HTTPè¯·æ±‚ï¼ˆåœ¨çº¿å¤´åƒAPIï¼‰
- **datetime** - æ—¶é—´å¤„ç†
- **random** - éšæœºæ•°ç”Ÿæˆ
- **math** - æ•°å­¦è®¡ç®—

### é¡¹ç›®ç»“æ„
```
wcscreen/
â”œâ”€â”€ genwechat.py                    # æ ¸å¿ƒç”Ÿæˆå™¨ç±»
â”œâ”€â”€ demo_avatars.py                 # å¤´åƒæ ·å¼æ¼”ç¤º
â”œâ”€â”€ demo_online_avatars.py          # åœ¨çº¿å¤´åƒæ¼”ç¤º
â”œâ”€â”€ training_mode.py                # åŸºç¡€è®­ç»ƒæ¨¡å¼
â”œâ”€â”€ smart_training_mode.py          # æ™ºèƒ½è®­ç»ƒæ¨¡å¼
â”œâ”€â”€ content_weaken_demo.py          # å†…å®¹å¼±åŒ–æ¼”ç¤º
â”œâ”€â”€ generate_training_dataset.py    # å¤§è§„æ¨¡æ•°æ®é›†ç”Ÿæˆ
â”œâ”€â”€ test_avatars.py                 # åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ run_wechat.bat                  # Windowsæ‰¹å¤„ç†è„šæœ¬
â”œâ”€â”€ requirements.txt                # ä¾èµ–åŒ…åˆ—è¡¨
â””â”€â”€ output/                         # è¾“å‡ºç›®å½•
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. ä¸»ç±»è®¾è®¡ - WeChatScreenshotGenerator

#### 1.1 åˆå§‹åŒ–é…ç½®
```python
class WeChatScreenshotGenerator:
    def __init__(self, width=750, height=1334):
        # å¾®ä¿¡é£æ ¼é¢œè‰²é…ç½®
        self.colors = {
            "background": "#EDEDED",      # èƒŒæ™¯è‰²
            "time_bg": "#D5D5D5",        # æ—¶é—´èƒŒæ™¯
            "friend_bubble": "#FFFFFF",   # æœ‹å‹æ¶ˆæ¯æ°”æ³¡
            "my_bubble": "#95EC69",       # æˆ‘çš„æ¶ˆæ¯æ°”æ³¡
            "friend_text": "#000000",     # æœ‹å‹æ¶ˆæ¯æ–‡å­—
            "my_text": "#000000",         # æˆ‘çš„æ¶ˆæ¯æ–‡å­—
            "name_text": "#8B8989"        # ç”¨æˆ·åæ–‡å­—
        }
        
        # ç”»å¸ƒåˆ›å»º
        self.image = Image.new("RGB", (width, height), self.colors["background"])
        self.draw = ImageDraw.Draw(self.image)
```

#### 1.2 å­—ä½“åŠ è½½æœºåˆ¶
```python
# å­—ä½“è‡ªåŠ¨åŠ è½½å’Œé™çº§å¤„ç†
font_paths = [
    r"C:\Windows\Fonts\simhei.ttf",  # é»‘ä½“ï¼ˆä¸»è¦ï¼‰
    r"C:\Windows\Fonts\simsun.ttc",  # å®‹ä½“ï¼ˆå¤‡é€‰ï¼‰
    r"C:\Windows\Fonts\arial.ttf"    # Arialï¼ˆå¤‡é€‰ï¼‰
]

# è‡ªåŠ¨å°è¯•åŠ è½½å­—ä½“ï¼Œå¤±è´¥æ—¶ä½¿ç”¨é»˜è®¤å­—ä½“
for font_path in font_paths:
    try:
        self.font = ImageFont.truetype(font_path, 18)
        self.name_font = ImageFont.truetype(font_path, 16)
        self.time_font = ImageFont.truetype(font_path, 14)
        break
    except Exception:
        continue
```

### 2. å¤´åƒç”ŸæˆæŠ€æœ¯

#### 2.1 åŸºäºåå­—çš„é¢œè‰²ç”Ÿæˆ
```python
def generate_avatar_color(self, name):
    """æ ¹æ®åå­—ç”Ÿæˆç¨³å®šçš„é¢œè‰²"""
    # ä½¿ç”¨å“ˆå¸Œç®—æ³•ç¡®ä¿åŒä¸€åå­—æ€»æ˜¯ç›¸åŒé¢œè‰²
    hash_value = hash(name) % 0xFFFFFF
    r = (hash_value >> 16) & 0xFF
    g = (hash_value >> 8) & 0xFF
    b = hash_value & 0xFF
    
    # ç¡®ä¿é¢œè‰²ä¸ä¼šå¤ªæš—
    if r + g + b < 200:
        r = min(255, r + 100)
        g = min(255, g + 100)
        b = min(255, b + 100)
    
    return (r, g, b)
```

#### 2.2 å¤šç§å¤´åƒæ ·å¼å®ç°

**å‡ ä½•å›¾æ¡ˆå¤´åƒï¼š**
```python
def draw_geometric_avatar(self, avatar_draw, name, size):
    pattern_type = hash(name) % 4
    
    if pattern_type == 0:
        # åœ†å½¢å›¾æ¡ˆ
        center = size // 2
        radius = size // 3
        avatar_draw.ellipse(
            (center - radius, center - radius, center + radius, center + radius),
            fill="white"
        )
    elif pattern_type == 1:
        # ä¸‰è§’å½¢å›¾æ¡ˆ
        points = [
            (size // 2, size // 4),
            (size // 4, 3 * size // 4),
            (3 * size // 4, 3 * size // 4)
        ]
        avatar_draw.polygon(points, fill="white")
    # ... å…¶ä»–å›¾æ¡ˆ
```

**é€¼çœŸå¤´åƒï¼š**
```python
def draw_realistic_avatar(self, avatar_draw, name, size):
    seed = hash(name)
    random.seed(seed)
    
    # ç”Ÿæˆå¤šå±‚å›¾æ¡ˆ
    layers = seed % 3 + 2  # 2-4å±‚
    
    for layer in range(layers):
        # æ¯å±‚ä½¿ç”¨ä¸åŒçš„é¢œè‰²å’Œé€æ˜åº¦
        layer_color = (
            (seed >> (layer * 8)) % 200 + 55,
            (seed >> (layer * 8 + 4)) % 200 + 55,
            (seed >> (layer * 8 + 8)) % 200 + 55
        )
        
        # éšæœºé€‰æ‹©å›¾æ¡ˆç±»å‹ï¼ˆåŒå¿ƒåœ†ã€å¤šè¾¹å½¢ã€çº¿æ¡ç­‰ï¼‰
        pattern = (seed >> (layer * 4)) % 6
        # ... ç»˜åˆ¶ä¸åŒå›¾æ¡ˆ
```

#### 2.3 åœ¨çº¿å¤´åƒAPIé›†æˆ
```python
def get_online_avatar(self, name):
    """ä»DiceBear APIè·å–å¤´åƒ"""
    apis = [
        f"https://api.dicebear.com/7.x/avataaars/png?seed={name}&size={self.avatar_size}",
        f"https://api.dicebear.com/7.x/pixel-art/png?seed={name}&size={self.avatar_size}",
        f"https://api.dicebear.com/7.x/bottts/png?seed={name}&size={self.avatar_size}",
        f"https://api.dicebear.com/7.x/human/png?seed={name}&size={self.avatar_size}"
    ]
    
    for api_url in apis:
        try:
            response = requests.get(api_url, timeout=10)
            if response.status_code == 200:
                img_data = BytesIO(response.content)
                avatar_img = Image.open(img_data)
                avatar_img = avatar_img.resize((self.avatar_size, self.avatar_size))
                return avatar_img
        except Exception:
            continue
```

### 3. æ¶ˆæ¯æ°”æ³¡ç»˜åˆ¶æŠ€æœ¯

#### 3.1 æ°”æ³¡å¸ƒå±€è®¡ç®—
```python
def draw_message_bubble(self, message, is_friend=True):
    # æ–‡æœ¬æ¢è¡Œå¤„ç†
    max_width = self.width * 0.6
    wrapped_text = textwrap.fill(message, width=20)
    lines = wrapped_text.split('\n')
    
    # è®¡ç®—æ°”æ³¡å°ºå¯¸
    line_height = 20
    bubble_width = min(max(self.draw.textbbox((0, 0), line, font=self.font)[2] for line in lines) + 
                      self.bubble_padding * 2, max_width)
    bubble_height = len(lines) * line_height + self.bubble_padding * 2
    
    # ç¡®å®šæ°”æ³¡ä½ç½®
    if is_friend:
        avatar_x = self.margin
        bubble_x = avatar_x + self.avatar_size + 10
    else:
        avatar_x = self.width - self.margin - self.avatar_size
        bubble_x = avatar_x - 10 - bubble_width
```

#### 3.2 åœ†è§’çŸ©å½¢ç»˜åˆ¶
```python
# ç»˜åˆ¶æ°”æ³¡èƒŒæ™¯
self.draw.rounded_rectangle(
    (bubble_x, bubble_y, bubble_x + bubble_width, bubble_y + bubble_height),
    radius=10, fill=bubble_color
)

# ç»˜åˆ¶æ–‡æœ¬
for i, line in enumerate(lines):
    self.draw.text(
        (bubble_x + self.bubble_padding, bubble_y + self.bubble_padding + i * line_height),
        line, fill=text_color, font=self.font
    )
```

### 4. ç•Œé¢å…ƒç´ ç»˜åˆ¶

#### 4.1 çŠ¶æ€æ ç»˜åˆ¶
```python
def draw_status_bar(self):
    # ç»˜åˆ¶èƒŒæ™¯
    self.draw.rectangle((0, 0, self.width, 40), fill="#000000")
    
    # ç»˜åˆ¶æ—¶é—´
    current_time = datetime.now().strftime("%H:%M")
    bbox = self.draw.textbbox((0, 0), current_time, font=self.time_font)
    text_width = bbox[2] - bbox[0]
    self.draw.text(
        ((self.width - text_width) // 2, 10), 
        current_time, fill="white", font=self.time_font
    )
    
    # ç»˜åˆ¶ç”µæ± å›¾æ ‡
    self.draw.rectangle((self.width - 30, 15, self.width - 15, 25), outline="white")
    self.draw.rectangle((self.width - 28, 17, self.width - 22, 23), fill="white")
```

#### 4.2 å¯¼èˆªæ ç»˜åˆ¶
```python
def draw_navigation_bar(self):
    # ç»˜åˆ¶èƒŒæ™¯
    self.draw.rectangle((0, self.height - 50, self.width, self.height), fill="#F7F7F7")
    
    # ç»˜åˆ¶åˆ†å‰²çº¿
    self.draw.line((0, self.height - 50, self.width, self.height - 50), fill="#DDDDDD")
    
    # ç»˜åˆ¶å¯¼èˆªé¡¹
    nav_items = ["å¾®ä¿¡", "é€šè®¯å½•", "å‘ç°", "æˆ‘"]
    item_width = self.width // len(nav_items)
    
    for i, item in enumerate(nav_items):
        x = i * item_width + item_width // 2
        self.draw.text(
            (x - 10, self.height - 35), item, 
            fill="#000000" if i == 0 else "#888888", font=self.name_font
        )
```

### 5. è®­ç»ƒæ¨¡å¼æŠ€æœ¯

#### 5.1 å¤´åƒå¼±åŒ–æŠ€æœ¯
```python
def weaken_avatar(self, avatar):
    """å¼±åŒ–å¤´åƒæ•ˆæœ"""
    if not self.avatar_weaken:
        return avatar
    
    weakened_avatar = avatar.copy()
    
    # é™ä½å¯¹æ¯”åº¦å’Œäº®åº¦
    if self.avatar_weaken_level > 0:
        import numpy as np
        img_array = np.array(weakened_avatar)
        
        # é™ä½å¯¹æ¯”åº¦
        contrast_factor = 1.0 - self.avatar_weaken_level * 0.8
        img_array = (img_array - 128) * contrast_factor + 128
        
        # é™ä½äº®åº¦
        brightness_factor = 1.0 - self.avatar_weaken_level * 0.6
        img_array = img_array * brightness_factor
        
        # ç¡®ä¿å€¼åœ¨æœ‰æ•ˆèŒƒå›´å†…
        img_array = np.clip(img_array, 0, 255).astype(np.uint8)
        weakened_avatar = Image.fromarray(img_array)
    
    # æ·»åŠ å™ªå£°
    if self.avatar_noise:
        noise = np.random.normal(0, 25 * self.avatar_weaken_level, img_array.shape)
        img_array = img_array + noise
        img_array = np.clip(img_array, 0, 255).astype(np.uint8)
        weakened_avatar = Image.fromarray(img_array)
    
    # æ¨¡ç³ŠåŒ–
    if self.avatar_blur:
        blur_radius = int(3 * self.avatar_weaken_level)
        if blur_radius > 0:
            weakened_avatar = weakened_avatar.filter(ImageFilter.GaussianBlur(blur_radius))
    
    return weakened_avatar
```

#### 5.2 å†…å®¹å¼±åŒ–æŠ€æœ¯
```python
def weaken_content(self, text):
    """å¼±åŒ–èŠå¤©å†…å®¹"""
    if not self.content_weaken or not self.training_mode:
        return text
    
    # æ ¹æ®å¼±åŒ–ç¨‹åº¦å†³å®šæ˜¯å¦æ›¿æ¢å†…å®¹
    if random.random() < self.content_weaken_level:
        placeholders = [
            "æ¶ˆæ¯å†…å®¹", "èŠå¤©è®°å½•", "å¯¹è¯å†…å®¹", "æ–‡æœ¬æ¶ˆæ¯",
            "ç”¨æˆ·è¾“å…¥", "èŠå¤©ä¿¡æ¯", "å¯¹è¯æ–‡æœ¬", "æ¶ˆæ¯æ–‡æœ¬"
        ]
        return random.choice(placeholders)
    
    return text
```

## ğŸ”§ å…³é”®æŠ€æœ¯ç‰¹ç‚¹

### 1. åŸºäºå“ˆå¸Œçš„ç¡®å®šæ€§ç”Ÿæˆ
- ä½¿ç”¨åå­—çš„å“ˆå¸Œå€¼ç”Ÿæˆé¢œè‰²å’Œå›¾æ¡ˆ
- ç¡®ä¿åŒä¸€åå­—æ€»æ˜¯ç”Ÿæˆç›¸åŒçš„å¤´åƒ
- æä¾›ä¸€è‡´æ€§å’Œå¯é¢„æµ‹æ€§

### 2. æ¸è¿›å¼å­—ä½“åŠ è½½
- è‡ªåŠ¨å°è¯•å¤šç§å­—ä½“è·¯å¾„
- å¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ°é»˜è®¤å­—ä½“
- ç¡®ä¿è·¨å¹³å°å…¼å®¹æ€§

### 3. æ™ºèƒ½ç¼“å­˜æœºåˆ¶
- åœ¨çº¿å¤´åƒAPIç»“æœç¼“å­˜
- é¿å…é‡å¤ç½‘ç»œè¯·æ±‚
- æé«˜ç”Ÿæˆæ•ˆç‡

### 4. è®­ç»ƒå‹å¥½çš„å¼±åŒ–ç­–ç•¥
- å¤´åƒå¼±åŒ–ï¼šé™ä½å¯¹æ¯”åº¦ã€æ·»åŠ å™ªå£°ã€æ¨¡ç³ŠåŒ–
- å†…å®¹å¼±åŒ–ï¼šç”¨å ä½ç¬¦æ›¿æ¢å…·ä½“å†…å®¹
- å¸®åŠ©æ¨¡å‹ä¸“æ³¨äºç•Œé¢ç‰¹å¾è€Œéå…·ä½“å†…å®¹

### 5. æ¨¡å—åŒ–è®¾è®¡
- åŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œæ˜“äºæ‰©å±•
- æ”¯æŒå¤šç§å¤´åƒæ ·å¼å’Œè®­ç»ƒæ¨¡å¼
- é«˜åº¦å¯é…ç½®çš„å‚æ•°ç³»ç»Ÿ

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. å›¾åƒå¤„ç†ä¼˜åŒ–
- ä½¿ç”¨PILçš„é«˜æ•ˆå›¾åƒæ“ä½œ
- åˆç†çš„å›¾åƒå°ºå¯¸å’Œæ ¼å¼
- å†…å­˜å‹å¥½çš„å¤„ç†æµç¨‹

### 2. æ‰¹é‡ç”Ÿæˆä¼˜åŒ–
- å¤ç”¨ç”Ÿæˆå™¨å®ä¾‹
- å‡å°‘é‡å¤åˆå§‹åŒ–å¼€é”€
- å¹¶è¡Œå¤„ç†æ”¯æŒ

### 3. ç½‘ç»œè¯·æ±‚ä¼˜åŒ–
- APIè¯·æ±‚è¶…æ—¶è®¾ç½®
- å¤±è´¥é‡è¯•æœºåˆ¶
- ç»“æœç¼“å­˜ç­–ç•¥

## ğŸ¯ åº”ç”¨åœºæ™¯

### 1. æœºå™¨å­¦ä¹ è®­ç»ƒ
- å¾®ä¿¡æˆªå›¾è¯†åˆ«æ¨¡å‹è®­ç»ƒ
- ç•Œé¢å…ƒç´ æ£€æµ‹
- å¸ƒå±€ç»“æ„åˆ†æ

### 2. æ•°æ®å¢å¼º
- è®­ç»ƒæ•°æ®å¤šæ ·åŒ–
- æ¨¡å‹æ³›åŒ–èƒ½åŠ›æå‡
- è¿‡æ‹Ÿåˆé˜²æ­¢

### 3. æµ‹è¯•éªŒè¯
- ç•Œé¢æµ‹è¯•æ•°æ®ç”Ÿæˆ
- åŠŸèƒ½éªŒè¯
- æ€§èƒ½æµ‹è¯•

## ğŸš€ æ‰©å±•æ€§è®¾è®¡

### 1. æ–°å¤´åƒæ ·å¼æ”¯æŒ
- æ’ä»¶å¼å¤´åƒç”Ÿæˆå™¨
- è‡ªå®šä¹‰å›¾æ¡ˆç®—æ³•
- ç¬¬ä¸‰æ–¹APIé›†æˆ

### 2. æ–°ç•Œé¢ä¸»é¢˜
- ä¸»é¢˜é…ç½®æ–‡ä»¶
- åŠ¨æ€é¢œè‰²æ–¹æ¡ˆ
- å¤šå¹³å°ç•Œé¢é€‚é…

### 3. é«˜çº§è®­ç»ƒåŠŸèƒ½
- æ›´å¤šå¼±åŒ–ç­–ç•¥
- è‡ªé€‚åº”å‚æ•°è°ƒæ•´
- è®­ç»ƒæ•ˆæœè¯„ä¼°

## ğŸ“ˆ æŠ€æœ¯ä¼˜åŠ¿

1. **é«˜åº¦é€¼çœŸ**ï¼šç²¾ç¡®æ¨¡æ‹Ÿå¾®ä¿¡ç•Œé¢ç»†èŠ‚
2. **è®­ç»ƒå‹å¥½**ï¼šä¸“é—¨è®¾è®¡çš„å¼±åŒ–ç­–ç•¥
3. **é«˜åº¦å¯é…ç½®**ï¼šä¸°å¯Œçš„å‚æ•°å’Œé€‰é¡¹
4. **è·¨å¹³å°å…¼å®¹**ï¼šæ”¯æŒWindowsã€Linuxã€macOS
5. **æ˜“äºæ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºåŠŸèƒ½æ‰©å±•
6. **æ€§èƒ½ä¼˜ç§€**ï¼šé«˜æ•ˆçš„å›¾åƒå¤„ç†å’Œç¼“å­˜æœºåˆ¶

## ğŸ”® æœªæ¥å‘å±•æ–¹å‘

1. **AIç”Ÿæˆå†…å®¹**ï¼šé›†æˆå¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆæ›´çœŸå®çš„èŠå¤©å†…å®¹
2. **åŠ¨æ€ç•Œé¢**ï¼šæ”¯æŒåŠ¨ç”»å’Œäº¤äº’æ•ˆæœ
3. **å¤šå¹³å°æ”¯æŒ**ï¼šæ‰©å±•åˆ°å…¶ä»–èŠå¤©åº”ç”¨çš„ç•Œé¢ç”Ÿæˆ
4. **äº‘ç«¯æœåŠ¡**ï¼šæä¾›åœ¨çº¿APIæœåŠ¡
5. **å¯è§†åŒ–é…ç½®**ï¼šå›¾å½¢åŒ–é…ç½®ç•Œé¢

---

*æœ¬æ–‡æ¡£æ€»ç»“äº†å¾®ä¿¡æˆªå›¾ç”Ÿæˆå™¨çš„æ ¸å¿ƒæŠ€æœ¯å®ç°ï¼Œä¸ºå¼€å‘è€…æä¾›äº†è¯¦ç»†çš„æŠ€æœ¯å‚è€ƒå’Œå®ç°æŒ‡å¯¼ã€‚*
